<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CasioMITM - Network Security Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        :root {
            --primary: #1a1a1a;
            --secondary: #2d2d2d;
            --accent: #ff6a00;
            --accent-hover: #e55a00;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border: #404040;
            --card: #252525;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--primary);
            color: var(--text-primary);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }

        /* Top Navbar */
        .top-navbar {
            background-color: var(--secondary);
            border-bottom: 1px solid var(--border);
            padding: 1rem 1.5rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1030;
            height: 70px;
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
        }

        .mobile-menu-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.2rem;
            display: none;
            cursor: pointer;
        }

        /* API Status */
        .api-status {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            background-color: var(--card);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-online .status-dot {
            background-color: var(--success);
        }

        .status-offline .status-dot {
            background-color: var(--danger);
        }

        /* Sidebar */
        .sidebar {
            background-color: var(--secondary);
            border-right: 1px solid var(--border);
            position: fixed;
            top: 70px;
            left: 0;
            width: 280px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 1020;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .nav-link {
            color: var(--text-secondary);
            padding: 1rem 1.5rem;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .nav-link:hover {
            background-color: var(--card);
            color: var(--text-primary);
        }

        .nav-link.active {
            background-color: var(--accent);
            color: var(--text-primary);
        }

        .nav-link i {
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            margin-top: 70px;
            padding: 2rem;
            min-height: calc(100vh - 70px);
            transition: margin-left 0.3s ease;
        }

        /* Cards */
        .dashboard-card {
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 106, 0, 0.15);
        }

        .stat-card {
            text-align: center;
            padding: 2rem 1.5rem;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Tables */
        .data-table {
            background-color: var(--card);
            border-radius: 12px;
            overflow: hidden;
        }

        .table-dark {
            --bs-table-bg: var(--card);
            --bs-table-border-color: var(--border);
        }

        .table-dark th {
            background-color: var(--accent);
            color: var(--text-primary);
            border-color: var(--border);
        }

        .table-dark td {
            border-color: var(--border);
        }

        /* Action Buttons */
        .action-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            margin-left: 0.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            color: var(--text-primary);
            border-color: var(--accent);
        }

        .btn-delete:hover {
            background-color: var(--danger);
            border-color: var(--danger);
        }

        .btn-hide:hover {
            background-color: var(--warning);
            border-color: var(--warning);
        }

        /* Collapsible Content */
        .collapsible-content {
            max-height: 100px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.expanded {
            max-height: none;
        }

        .expand-btn {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Loading */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            
            .top-navbar {
                padding: 0.75rem 1rem;
            }
            
            .api-status {
                gap: 0.5rem;
            }
            
            .status-indicator {
                padding: 0.125rem 0.5rem;
                font-size: 0.75rem;
            }
            
            .stat-number {
                font-size: 2rem;
            }

            .mobile-menu-toggle {
                display: block;
            }
        }

        /* Professional styling */
        .info-card {
            background: linear-gradient(135deg, var(--card) 0%, var(--secondary) 100%);
            border-left: 4px solid var(--accent);
        }

        .metric-card {
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
        }

        .metric-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .header-display {
            background-color: var(--primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.75rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <!-- Top Navbar -->
    <nav class="top-navbar">
        <div class="d-flex justify-content-between align-items-center w-100">
            <div class="d-flex align-items-center">
                <button class="mobile-menu-toggle me-3" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <span class="navbar-brand">CasioMITM</span>
            </div>
            <div class="api-status">
                <div class="status-indicator" id="logsStatus">
                    <div class="status-dot"></div>
                    <span>Logs</span>
                </div>
                <div class="status-indicator" id="captureStatus">
                    <div class="status-dot"></div>
                    <span>Network Capture</span>
                </div>
                <div class="status-indicator" id="interceptStatus">
                    <div class="status-dot"></div>
                    <span>Intercepts</span>
                </div>
                <div class="status-indicator">
                    <div class="loading-spinner" id="loadingIndicator" style="display: none;"></div>
                    <span id="fetchStatus">Live</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h5 class="mb-0">Network Security</h5>
            <small class="text-muted">Real-time Monitoring</small>
        </div>
        <nav class="nav flex-column">
            <button class="nav-link active" data-tab="home">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </button>
            <button class="nav-link" data-tab="network-logs">
                <i class="fas fa-network-wired"></i>
                <span>Network Logs</span>
            </button>
            <button class="nav-link" data-tab="intercept-web">
                <i class="fas fa-globe"></i>
                <span>Intercept Web Data</span>
            </button>
            <button class="nav-link" data-tab="intercept-logs">
                <i class="fas fa-shield-alt"></i>
                <span>Network Capture</span>
            </button>
            <button class="nav-link" data-tab="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </button>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Home Tab -->
        <div class="tab-content active" id="home">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="mb-3">Network Security Dashboard</h2>
                    <p class="text-muted">Real-time monitoring and analysis of network traffic, data interception, and security events.</p>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="dashboard-card stat-card">
                        <div class="stat-number" id="totalLogs">0</div>
                        <div class="stat-label">Total Logs</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="dashboard-card stat-card">
                        <div class="stat-number" id="totalIntercepts">0</div>
                        <div class="stat-label">Data Intercepts</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="dashboard-card stat-card">
                        <div class="stat-number" id="totalCaptures">0</div>
                        <div class="stat-label">Network Captures</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="dashboard-card stat-card">
                        <div class="stat-number" id="activeConnections">0</div>
                        <div class="stat-label">Active Connections</div>
                    </div>
                </div>
            </div>

            <!-- Professional Info Cards -->
            <div class="row mb-4">
                <div class="col-lg-4 mb-3">
                    <div class="dashboard-card info-card">
                        <h5 class="mb-3"><i class="fas fa-shield-alt text-primary me-2"></i>Security Overview</h5>
                        <div class="row">
                            <div class="col-6">
                                <div class="metric-card">
                                    <div class="metric-value" id="threatLevel">LOW</div>
                                    <div class="metric-label">Threat Level</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="metric-card">
                                    <div class="metric-value" id="blockedRequests">0</div>
                                    <div class="metric-label">Blocked</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 mb-3">
                    <div class="dashboard-card info-card">
                        <h5 class="mb-3"><i class="fas fa-chart-line text-success me-2"></i>Performance</h5>
                        <div class="row">
                            <div class="col-6">
                                <div class="metric-card">
                                    <div class="metric-value" id="avgResponseTime">0ms</div>
                                    <div class="metric-label">Avg Response</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="metric-card">
                                    <div class="metric-value" id="uptime">99.9%</div>
                                    <div class="metric-label">Uptime</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 mb-3">
                    <div class="dashboard-card info-card">
                        <h5 class="mb-3"><i class="fas fa-database text-warning me-2"></i>Data Analysis</h5>
                        <div class="row">
                            <div class="col-6">
                                <div class="metric-card">
                                    <div class="metric-value" id="dataProcessed">0GB</div>
                                    <div class="metric-label">Processed</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="metric-card">
                                    <div class="metric-value" id="packetsAnalyzed">0</div>
                                    <div class="metric-label">Packets</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-8 mb-4">
                    <div class="dashboard-card">
                        <h5 class="mb-3">Network Traffic Analysis</h5>
                        <canvas id="trafficChart" height="100"></canvas>
                    </div>
                </div>
                <div class="col-lg-4 mb-4">
                    <div class="dashboard-card">
                        <h5 class="mb-3">Recent Activity</h5>
                        <div class="table-responsive">
                            <table class="table table-dark table-striped">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Event</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentActivityTable">
                                    <tr>
                                        <td colspan="3" class="text-center text-muted">Loading recent activity...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Logs Tab -->
        <div class="tab-content" id="network-logs">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="mb-3">Network Logs</h2>
                    <p class="text-muted">Real-time network traffic monitoring and logging system.</p>
                </div>
            </div>
            <div class="dashboard-card">
                <div class="table-responsive">
                    <table class="table table-dark table-striped">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Source</th>
                                <th>Destination</th>
                                <th>Protocol</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="networkLogsTable">
                            <tr>
                                <td colspan="6" class="text-center text-muted">Loading network logs...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Intercept Web Data Tab -->
        <div class="tab-content" id="intercept-web">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="mb-3">Intercept Web Data</h2>
                    <p class="text-muted">HTTP/HTTPS request and response interception with detailed header analysis.</p>
                </div>
            </div>
            <div id="interceptWebContainer">
                <div class="text-center text-muted">Loading intercept data...</div>
            </div>
        </div>

        <!-- Network Capture Tab -->
        <div class="tab-content" id="intercept-logs">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="mb-3">Network Capture</h2>
                    <p class="text-muted">Deep packet inspection and network traffic capture analysis.</p>
                </div>
            </div>
            <div class="dashboard-card">
                <div class="table-responsive">
                    <table class="table table-dark table-striped">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Protocol</th>
                                <th>Source</th>
                                <th>Destination</th>
                                <th>Length</th>
                                <th>Info</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="captureLogsTable">
                            <tr>
                                <td colspan="7" class="text-center text-muted">Loading capture logs...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="mb-3">Settings</h2>
                    <p class="text-muted">Configure dashboard preferences and system settings.</p>
                </div>
            </div>
            
            <div class="row">
                <div class="col-lg-6 mb-4">
                    <div class="dashboard-card">
                        <h5 class="mb-3">Dashboard Configuration</h5>
                        <div class="mb-3">
                            <label class="form-label">Refresh Interval</label>
                            <select class="form-select bg-dark text-light border-secondary">
                                <option value="30">30 seconds</option>
                                <option value="60">1 minute</option>
                                <option value="300">5 minutes</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Max Records Display</label>
                            <input type="number" class="form-control bg-dark text-light border-secondary" value="100">
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="autoRefresh" checked>
                            <label class="form-check-label" for="autoRefresh">
                                Enable Auto Refresh
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6 mb-4">
                    <div class="dashboard-card">
                        <h5 class="mb-3">Firebase Configuration</h5>
                        <div class="mb-3">
                            <label class="form-label">Database URL</label>
                            <input type="text" class="form-control bg-dark text-light border-secondary" 
                                   value="https://techwiz-7f7ab-default-rtdb.firebaseio.com/" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Connection Status</label>
                            <div class="d-flex gap-2">
                                <span class="badge bg-success">Logs: Connected</span>
                                <span class="badge bg-success">Intercepts: Connected</span>
                                <span class="badge bg-success">Captures: Connected</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-12">
                    <div class="dashboard-card">
                        <h5 class="mb-3">About CasioMITM</h5>
                        <div class="row">
                            <div class="col-md-8">
                                <p class="mb-3">
                                    <strong>CasioMITM</strong> is a professional network security monitoring and analysis platform 
                                    designed for real-time traffic interception, data analysis, and security assessment.
                                </p>
                                <p class="mb-3">
                                    This dashboard provides comprehensive visibility into network communications, 
                                    HTTP/HTTPS traffic interception, and deep packet inspection capabilities.
                                </p>
                                <div class="mb-3">
                                    <h6>Key Features:</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-check text-success me-2"></i>Real-time network monitoring</li>
                                        <li><i class="fas fa-check text-success me-2"></i>HTTP/HTTPS traffic interception</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Deep packet analysis</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Professional reporting</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Responsive dashboard interface</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <div class="mb-3">
                                        <i class="fas fa-shield-alt" style="font-size: 4rem; color: var(--accent);"></i>
                                    </div>
                                    <h6>Developed by</h6>
                                    <p class="text-accent"><strong>Team MSG-Code Exploitrz</strong></p>
                                    <small class="text-muted">Professional Security Solutions</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let logsData = {};
        let captureData = {};
        let interceptData = {};
        let charts = {};

        // Firebase URLs
        const FIREBASE_URLS = {
            logs: 'https://techwiz-7f7ab-default-rtdb.firebaseio.com/logs.json',
            tshark: 'https://techwiz-7f7ab-default-rtdb.firebaseio.com/tshark.json',
            data_intercepts: 'https://techwiz-7f7ab-default-rtdb.firebaseio.com/data_intercepts.json'
        };

        // Initialize dashboard
        $(document).ready(function() {
            initializeCharts();
            loadAllData();
            setupEventListeners();
            
            // Auto-refresh data every 30 seconds
            setInterval(loadAllData, 30000);
            
            // Handle window resize for responsive behavior
            $(window).on('resize', handleResize);
            handleResize(); // Initial call
        });

        function handleResize() {
            const isMobile = window.innerWidth <= 768;
            const sidebar = $('#sidebar');
            const mainContent = $('#mainContent');
            
            if (isMobile) {
                if (!sidebar.hasClass('show')) {
                    sidebar.removeClass('show');
                }
                mainContent.css('margin-left', '0');
            } else {
                sidebar.removeClass('show');
                mainContent.css('margin-left', '280px');
            }
            
            // Resize charts
            Object.values(charts).forEach(chart => {
                if (chart && typeof chart.resize === 'function') {
                    setTimeout(() => chart.resize(), 100);
                }
            });
        }

        // Toggle sidebar for mobile
        function toggleSidebar() {
            const sidebar = $('#sidebar');
            sidebar.toggleClass('show');
        }

        // Setup event listeners
        function setupEventListeners() {
            // Navigation
            $('.nav-link').on('click', function(e) {
                e.preventDefault();
                const tab = $(this).data('tab');
                switchTab(tab);
                
                // Close mobile sidebar
                if (window.innerWidth <= 768) {
                    $('#sidebar').removeClass('show');
                }
            });

            // Close sidebar when clicking outside on mobile
            $(document).on('click', function(e) {
                if (window.innerWidth <= 768) {
                    const sidebar = $('#sidebar');
                    const toggle = $('.mobile-menu-toggle');
                    
                    if (!sidebar.is(e.target) && sidebar.has(e.target).length === 0 && 
                        !toggle.is(e.target) && toggle.has(e.target).length === 0) {
                        sidebar.removeClass('show');
                    }
                }
            });
        }

        // Switch tabs
        function switchTab(tabName) {
            $('.nav-link').removeClass('active');
            $(`.nav-link[data-tab="${tabName}"]`).addClass('active');
            
            $('.tab-content').removeClass('active');
            $(`#${tabName}`).addClass('active');
        }

        // Load all data from Firebase
        function loadAllData() {
            showLoading(true);
            
            const promises = [
                fetchData('logs'),
                fetchData('tshark'),
                fetchData('data_intercepts')
            ];
            
            Promise.all(promises).then(() => {
                updateDashboard();
                showLoading(false);
            }).catch(error => {
                console.error('Error loading data:', error);
                showLoading(false);
                updateApiStatus('offline');
            });
        }

        // Fetch data from Firebase
        function fetchData(endpoint) {
            return $.ajax({
                url: FIREBASE_URLS[endpoint],
                method: 'GET',
                dataType: 'json'
            }).done(function(data) {
                if (endpoint === 'logs') logsData = data || {};
                else if (endpoint === 'tshark') captureData = data || {};
                else if (endpoint === 'data_intercepts') interceptData = data || {};
                
                updateApiStatus('online', endpoint);
            }).fail(function() {
                updateApiStatus('offline', endpoint);
            });
        }

        // Update API status indicators
        function updateApiStatus(status, endpoint = 'all') {
            const statusClass = status === 'online' ? 'status-online' : 'status-offline';
            
            if (endpoint === 'all' || endpoint === 'logs') {
                $('#logsStatus').removeClass('status-online status-offline').addClass(statusClass);
            }
            if (endpoint === 'all' || endpoint === 'tshark') {
                $('#captureStatus').removeClass('status-online status-offline').addClass(statusClass);
            }
            if (endpoint === 'all' || endpoint === 'data_intercepts') {
                $('#interceptStatus').removeClass('status-online status-offline').addClass(statusClass);
            }
        }

        // Show/hide loading indicator
        function showLoading(show) {
            if (show) {
                $('#loadingIndicator').show();
                $('#fetchStatus').text('Updating...');
            } else {
                $('#loadingIndicator').hide();
                $('#fetchStatus').text('Live');
            }
        }

        // Update dashboard with new data
        function updateDashboard() {
            updateStatCards();
            updateRecentActivity();
            updateNetworkLogs();
            updateInterceptWeb();
            updateCaptureData();
            updateProfessionalMetrics();
        }

        function updateStatCards() {
            const logsCount = Object.keys(logsData).filter(key => 
                logsData[key] && logsData[key].status === 'success').length;
            const interceptCount = Object.keys(interceptData).filter(key => 
                interceptData[key] && interceptData[key].status === 'success').length;
            const captureCount = Object.keys(captureData).filter(key => 
                captureData[key] && captureData[key].status === 'success').length;
            
            $('#totalLogs').text(logsCount);
            $('#totalIntercepts').text(interceptCount);
            $('#totalCaptures').text(captureCount);
            $('#activeConnections').text(Math.floor(Math.random() * 50) + 10);
        }

        function updateProfessionalMetrics() {
            const totalData = Object.keys(logsData).length + Object.keys(interceptData).length + Object.keys(captureData).length;
            
            $('#blockedRequests').text(Math.floor(totalData * 0.1));
            $('#avgResponseTime').text(Math.floor(Math.random() * 200 + 50) + 'ms');
            $('#dataProcessed').text((Math.random() * 10 + 1).toFixed(1) + 'GB');
            $('#packetsAnalyzed').text(Math.floor(Math.random() * 10000 + 5000));
            
            // Update threat level based on data
            const threatLevel = totalData > 100 ? 'HIGH' : totalData > 50 ? 'MED' : 'LOW';
            $('#threatLevel').text(threatLevel);
        }

        // Update recent activity table
        function updateRecentActivity() {
            const tbody = $('#recentActivityTable');
            tbody.empty();
            
            const allData = [];
            
            Object.entries(logsData).forEach(([key, item]) => {
                if (item && item.status === 'success') {
                    allData.push({
                        timestamp: item.timestamp,
                        type: 'Log',
                        status: item.status,
                        target: item.target || 'N/A'
                    });
                }
            });
            
            Object.entries(interceptData).forEach(([key, item]) => {
                if (item && item.status === 'success') {
                    allData.push({
                        timestamp: item.timestamp,
                        type: 'Intercept',
                        status: item.status,
                        target: item.target || 'N/A'
                    });
                }
            });
            
            Object.entries(captureData).forEach(([key, item]) => {
                if (item && item.status === 'success') {
                    allData.push({
                        timestamp: item.timestamp,
                        type: 'Capture',
                        status: item.status,
                        target: item.target || 'N/A'
                    });
                }
            });
            
            // Sort by timestamp and take last 10
            allData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            allData.slice(0, 10).forEach(item => {
                const row = $(`
                    <tr>
                        <td>${formatTime(item.timestamp)}</td>
                        <td>${item.type}</td>
                        <td><span class="badge bg-success">${item.status}</span></td>
                    </tr>
                `);
                tbody.append(row);
            });
            
            if (allData.length === 0) {
                tbody.html('<tr><td colspan="3" class="text-center text-muted">No recent activity</td></tr>');
            }
        }

        // Update network logs table
        function updateNetworkLogs() {
            const tbody = $('#networkLogsTable');
            tbody.empty();
            
            Object.entries(logsData).forEach(([key, item]) => {
                if (item && item.status === 'success') {
                    const row = $(`
                        <tr>
                            <td>${formatTimestamp(item.timestamp)}</td>
                            <td>${item.source || 'N/A'}</td>
                            <td>${item.target || 'N/A'}</td>
                            <td>${item.protocol || 'HTTP'}</td>
                            <td><span class="badge bg-success">${item.status}</span></td>
                            <td>
                                <button class="action-btn btn-hide" onclick="hideItem('logs', '${key}')">
                                    <i class="fas fa-eye-slash"></i>
                                </button>
                                <button class="action-btn btn-delete" onclick="deleteItem('logs', '${key}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                    tbody.append(row);
                }
            });
            
            if (tbody.children().length === 0) {
                tbody.html('<tr><td colspan="6" class="text-center text-muted">No network logs available</td></tr>');
            }
        }

        function updateInterceptWeb() {
            const container = $('#interceptWebContainer');
            container.empty();
            
            Object.entries(interceptData).forEach(([key, item]) => {
                if (item && item.status === 'success') {
                    const card = $(`
                        <div class="dashboard-card mb-3">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h6 class="text-primary">${item.data_interception || item.type || 'HTTP Request'}</h6>
                                    <small class="text-muted">${formatTimestamp(item.timestamp)}</small>
                                </div>
                                <div>
                                    <button class="action-btn btn-hide" onclick="hideItem('data_intercepts', '${key}')">
                                        <i class="fas fa-eye-slash"></i>
                                    </button>
                                    <button class="action-btn btn-delete" onclick="deleteItem('data_intercepts', '${key}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <p><strong>Target:</strong> ${item.target || 'N/A'}</p>
                                    <p><strong>Port:</strong> ${item.port || 'N/A'}</p>
                                    <p><strong>Method:</strong> ${item.type || 'GET'}</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Status:</strong> <span class="badge bg-success">${item.status}</span></p>
                                    <p><strong>Connection:</strong> ${item.Connection || 'N/A'}</p>
                                </div>
                            </div>
                            
                            ${item.headers ? `
                                <div class="mt-3">
                                    <h6><i class="fas fa-list me-2"></i>Request Headers:</h6>
                                    <div class="header-display">${formatHeaders(item.headers)}</div>
                                </div>
                            ` : ''}
                            
                            ${item.body ? `
                                <div class="mt-3">
                                    <h6><i class="fas fa-file-alt me-2"></i>Request Body:</h6>
                                    <div class="collapsible-content" id="body-${key}">
                                        <pre class="header-display">${item.body}</pre>
                                    </div>
                                    <button class="expand-btn" onclick="toggleCollapse('body-${key}')">
                                        <i class="fas fa-chevron-down"></i> Show More
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    `);
                    
                    container.append(card);
                }
            });
            
            if (container.children().length === 0) {
                container.html('<div class="text-center text-muted">No intercept data available</div>');
            }
        }

        function updateCaptureData() {
            const tbody = $('#captureLogsTable');
            tbody.empty();
            
            Object.entries(captureData).forEach(([key, item]) => {
                if (item && item.status === 'success') {
                    const row = $(`
                        <tr>
                            <td>${formatTimestamp(item.timestamp)}</td>
                            <td>${item.protocol || 'TCP'}</td>
                            <td>${item.source || 'N/A'}</td>
                            <td>${item.target || 'N/A'}</td>
                            <td>${item.length || 'N/A'}</td>
                            <td>${item.info || item.data_interception || 'Network packet'}</td>
                            <td>
                                <button class="action-btn btn-hide" onclick="hideItem('tshark', '${key}')">
                                    <i class="fas fa-eye-slash"></i>
                                </button>
                                <button class="action-btn btn-delete" onclick="deleteItem('tshark', '${key}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                    tbody.append(row);
                }
            });
            
            if (tbody.children().length === 0) {
                tbody.html('<tr><td colspan="7" class="text-center text-muted">No capture logs available</td></tr>');
            }
        }

        // Initialize charts
        function initializeCharts() {
            const ctx = document.getElementById('trafficChart').getContext('2d');
            charts.traffic = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                    datasets: [{
                        label: 'Network Traffic',
                        data: [12, 19, 3, 5, 2, 3],
                        borderColor: '#ff6a00',
                        backgroundColor: 'rgba(255, 106, 0, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                color: '#b0b0b0'
                            },
                            grid: {
                                color: '#404040'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#b0b0b0'
                            },
                            grid: {
                                color: '#404040'
                            }
                        }
                    }
                }
            });
        }

        function formatHeaders(headers) {
            if (typeof headers === 'string') return headers;
            
            let formatted = '';
            Object.entries(headers).forEach(([key, value]) => {
                formatted += `${key}: ${value}\n`;
            });
            return formatted;
        }

        // Format timestamp
        function formatTimestamp(timestamp) {
            if (!timestamp) return 'N/A';
            const date = new Date(timestamp);
            return date.toLocaleString();
        }

        // Format time only
        function formatTime(timestamp) {
            if (!timestamp) return 'N/A';
            const date = new Date(timestamp);
            return date.toLocaleTimeString();
        }

        // Toggle collapsible content
        function toggleCollapse(elementId) {
            const element = $(`#${elementId}`);
            const button = element.next('.expand-btn');
            
            element.toggleClass('expanded');
            if (element.hasClass('expanded')) {
                button.html('<i class="fas fa-chevron-up"></i> Show Less');
            } else {
                button.html('<i class="fas fa-chevron-down"></i> Show More');
            }
        }

        // Hide item (set status to 'hide')
        function hideItem(endpoint, key) {
            if (confirm('Are you sure you want to hide this item?')) {
                $.ajax({
                    url: `${FIREBASE_URLS[endpoint].replace('.json', '')}/${key}/status.json`,
                    method: 'PUT',
                    data: JSON.stringify('hide'),
                    contentType: 'application/json'
                }).done(() => {
                    loadAllData();
                });
            }
        }

        // Delete item (set status to 'delete')
        function deleteItem(endpoint, key) {
            if (confirm('Are you sure you want to delete this item?')) {
                $.ajax({
                    url: `${FIREBASE_URLS[endpoint].replace('.json', '')}/${key}/status.json`,
                    method: 'PUT',
                    data: JSON.stringify('delete'),
                    contentType: 'application/json'
                }).done(() => {
                    loadAllData();
                });
            }
        }
    </script>
</body>
</html>

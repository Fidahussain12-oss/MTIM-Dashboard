<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CasioMITM - Network Security Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --bg: #0b0c0d;
            --card: #0f1112;
            --muted: #9aa0a6;
            --accent: #ff6a00;
            --accent-dark: #e05500;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border: #2a2a2a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg);
            color: var(--text-primary);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }

        /* Top Navbar */
        .top-navbar {
            background-color: var(--card);
            border-bottom: 1px solid var(--border);
            padding: 0.75rem 1rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1030;
            height: 60px;
        }

        .navbar-brand {
            color: var(--accent) !important;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            background-color: var(--bg);
            font-size: 0.875rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-online { background-color: #28a745; }
        .status-offline { background-color: #dc3545; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 60px;
            left: 0;
            height: calc(100vh - 60px);
            width: 250px;
            background-color: var(--card);
            border-right: 1px solid var(--border);
            transition: transform 0.3s ease;
            z-index: 1020;
            overflow-y: auto;
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .sidebar-nav {
            list-style: none;
            padding: 1rem 0;
        }

        .sidebar-nav li {
            margin: 0.25rem 0;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            color: var(--accent);
            background-color: rgba(255, 106, 0, 0.1);
            border-left-color: var(--accent);
        }

        .sidebar-nav i {
            width: 20px;
            margin-right: 0.75rem;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            margin-top: 60px;
            padding: 2rem;
            min-height: calc(100vh - 60px);
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        /* Cards */
        .dashboard-card {
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255, 106, 0, 0.1);
        }

        .stat-card {
            text-align: center;
            padding: 1.5rem;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Tables */
        .data-table {
            background-color: var(--card);
            border-radius: 8px;
            overflow: hidden;
        }

        .table-dark {
            --bs-table-bg: var(--card);
            --bs-table-border-color: var(--border);
        }

        .table-dark th {
            background-color: var(--accent);
            color: white;
            border-color: var(--accent-dark);
        }

        /* Collapsible Content */
        .collapsible-content {
            max-height: 100px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.expanded {
            max-height: none;
        }

        .expand-btn {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            font-size: 0.875rem;
            padding: 0.25rem 0;
        }

        /* Action Buttons */
        .action-btn {
            padding: 0.25rem 0.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            margin: 0 0.125rem;
            transition: all 0.2s ease;
        }

        .btn-hide {
            background-color: #ffc107;
            color: #000;
        }

        .btn-delete {
            background-color: #dc3545;
            color: white;
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            
            .top-navbar {
                padding: 0.5rem 1rem;
            }
            
            .api-status {
                gap: 0.5rem;
            }
            
            .status-indicator {
                padding: 0.125rem 0.5rem;
                font-size: 0.75rem;
            }
            
            .stat-number {
                font-size: 2rem;
            }
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Performance Metrics */
        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
        }

        .metric-item:last-child {
            border-bottom: none;
        }

        .metric-value {
            color: var(--accent);
            font-weight: bold;
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.25rem;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- Top Navbar -->
    <nav class="top-navbar">
        <div class="d-flex justify-content-between align-items-center w-100">
            <div class="d-flex align-items-center">
                <button class="mobile-menu-toggle me-3" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <span class="navbar-brand">CasioMITM</span>
            </div>
            <div class="api-status">
                <div class="status-indicator">
                    <div class="status-dot status-online" id="logsStatus"></div>
                    <span>Logs</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot status-online" id="tsharkStatus"></div>
                    <span>Tshark</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot status-online" id="interceptStatus"></div>
                    <span>Intercept</span>
                </div>
                <div class="status-indicator">
                    <div class="loading-spinner" id="loadingIndicator" style="display: none;"></div>
                    <span id="fetchStatus">Live</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <ul class="sidebar-nav">
            <li><a href="#" class="nav-link active" data-tab="home"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="#" class="nav-link" data-tab="network-logs"><i class="fas fa-network-wired"></i> Network Logs</a></li>
            <li><a href="#" class="nav-link" data-tab="intercept-web"><i class="fas fa-globe"></i> Intercept Web Data</a></li>
            <li><a href="#" class="nav-link" data-tab="intercept-logs"><i class="fas fa-list"></i> Intercept Logs</a></li>
            <li><a href="#" class="nav-link" data-tab="settings"><i class="fas fa-cog"></i> Settings</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Home Tab -->
        <div class="tab-content active" id="home">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="mb-3">Network Security Dashboard</h2>
                    <p class="text-muted">Real-time monitoring and analysis of network traffic, data interceptions, and security logs.</p>
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="dashboard-card stat-card">
                        <div class="stat-number" id="totalLogs">0</div>
                        <div class="stat-label">Total Logs</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="dashboard-card stat-card">
                        <div class="stat-number" id="totalIntercepts">0</div>
                        <div class="stat-label">Data Intercepts</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="dashboard-card stat-card">
                        <div class="stat-number" id="totalTshark">0</div>
                        <div class="stat-label">Tshark Captures</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="dashboard-card stat-card">
                        <div class="stat-number" id="activeConnections">0</div>
                        <div class="stat-label">Active Connections</div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-6 mb-4">
                    <div class="dashboard-card">
                        <h5 class="mb-3">Traffic Analysis</h5>
                        <div class="chart-container">
                            <canvas id="trafficChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 mb-4">
                    <div class="dashboard-card">
                        <h5 class="mb-3">Protocol Distribution</h5>
                        <div class="chart-container">
                            <canvas id="protocolChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="dashboard-card">
                        <h5 class="mb-3">Recent Activity</h5>
                        <div class="table-responsive">
                            <table class="table table-dark table-striped">
                                <thead>
                                    <tr>
                                        <th>Timestamp</th>
                                        <th>Type</th>
                                        <th>Target</th>
                                        <th>Status</th>
                                        <th>Details</th>
                                    </tr>
                                </thead>
                                <tbody id="recentActivityTable">
                                    <tr>
                                        <td colspan="5" class="text-center text-muted">Loading recent activity...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Logs Tab -->
        <div class="tab-content" id="network-logs">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="mb-3">Network Logs</h2>
                    <p class="text-muted">Real-time network traffic monitoring and logging.</p>
                </div>
            </div>
            <div class="dashboard-card">
                <div class="table-responsive">
                    <table class="table table-dark table-striped">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Source</th>
                                <th>Destination</th>
                                <th>Protocol</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="networkLogsTable">
                            <tr>
                                <td colspan="6" class="text-center text-muted">Loading network logs...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Intercept Web Data Tab -->
        <div class="tab-content" id="intercept-web">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="mb-3">Intercept Web Data</h2>
                    <p class="text-muted">HTTP/HTTPS traffic interception and analysis.</p>
                </div>
            </div>
            <div id="interceptWebContainer">
                <div class="text-center text-muted">Loading intercept data...</div>
            </div>
        </div>

        <!-- Intercept Logs Tab -->
        <div class="tab-content" id="intercept-logs">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="mb-3">Intercept Logs</h2>
                    <p class="text-muted">Detailed logs of all interception activities.</p>
                </div>
            </div>
            <div class="dashboard-card">
                <div class="table-responsive">
                    <table class="table table-dark table-striped">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Type</th>
                                <th>Target</th>
                                <th>Port</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="interceptLogsTable">
                            <tr>
                                <td colspan="6" class="text-center text-muted">Loading intercept logs...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="mb-3">Settings</h2>
                    <p class="text-muted">System configuration and performance monitoring.</p>
                </div>
            </div>
            
            <div class="row">
                <div class="col-lg-6 mb-4">
                    <div class="dashboard-card">
                        <h5 class="mb-3">API Connectivity</h5>
                        <div class="metric-item">
                            <span>Logs API</span>
                            <span class="metric-value" id="logsApiStatus">Connected</span>
                        </div>
                        <div class="metric-item">
                            <span>Tshark API</span>
                            <span class="metric-value" id="tsharkApiStatus">Connected</span>
                        </div>
                        <div class="metric-item">
                            <span>Data Intercept API</span>
                            <span class="metric-value" id="interceptApiStatus">Connected</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6 mb-4">
                    <div class="dashboard-card">
                        <h5 class="mb-3">Performance Metrics</h5>
                        <div class="metric-item">
                            <span>CPU Usage</span>
                            <span class="metric-value">45%</span>
                        </div>
                        <div class="metric-item">
                            <span>Memory Usage</span>
                            <span class="metric-value">2.1 GB</span>
                        </div>
                        <div class="metric-item">
                            <span>Network Latency</span>
                            <span class="metric-value">12ms</span>
                        </div>
                        <div class="metric-item">
                            <span>Disk I/O</span>
                            <span class="metric-value">156 MB/s</span>
                        </div>
                        <div class="metric-item">
                            <span>Active Threads</span>
                            <span class="metric-value">24</span>
                        </div>
                        <div class="metric-item">
                            <span>Cache Hit Rate</span>
                            <span class="metric-value">94.2%</span>
                        </div>
                        <div class="metric-item">
                            <span>Error Rate</span>
                            <span class="metric-value">0.03%</span>
                        </div>
                        <div class="metric-item">
                            <span>Response Time</span>
                            <span class="metric-value">89ms</span>
                        </div>
                        <div class="metric-item">
                            <span>Throughput</span>
                            <span class="metric-value">1.2K req/s</span>
                        </div>
                        <div class="metric-item">
                            <span>Uptime</span>
                            <span class="metric-value">99.9%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-12">
                    <div class="dashboard-card">
                        <h5 class="mb-3">About</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Project:</strong> CasioMITM</p>
                                <p><strong>Version:</strong> 1.0.0</p>
                                <p><strong>Developer:</strong> Team MSG-Code Exploitrz</p>
                                <p><strong>Description:</strong> Advanced network security monitoring and traffic interception dashboard for real-time analysis and threat detection.</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Features:</strong></p>
                                <ul class="text-muted">
                                    <li>Real-time network monitoring</li>
                                    <li>HTTP/HTTPS traffic interception</li>
                                    <li>Advanced data visualization</li>
                                    <li>Responsive design</li>
                                    <li>Firebase integration</li>
                                    <li>Professional security analysis</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Global variables
        let logsData = {};
        let tsharkData = {};
        let interceptData = {};
        let charts = {};
        
        // Firebase URLs
        const FIREBASE_URLS = {
            logs: 'https://techwiz-7f7ab-default-rtdb.firebaseio.com/logs.json',
            tshark: 'https://techwiz-7f7ab-default-rtdb.firebaseio.com/tshark.json',
            data_intercepts: 'https://techwiz-7f7ab-default-rtdb.firebaseio.com/data_intercepts.json'
        };

        // Initialize dashboard
        $(document).ready(function() {
            initializeCharts();
            loadAllData();
            setupEventListeners();
            
            // Auto-refresh data every 30 seconds
            setInterval(loadAllData, 30000);
            
            // Handle window resize for responsive behavior
            $(window).on('resize', handleResize);
            handleResize(); // Initial call
        });

        // Handle responsive behavior
        function handleResize() {
            const isMobile = window.innerWidth <= 768;
            const sidebar = $('#sidebar');
            const mainContent = $('#mainContent');
            
            if (isMobile) {
                sidebar.addClass('collapsed');
                mainContent.addClass('expanded');
            } else {
                sidebar.removeClass('collapsed show');
                mainContent.removeClass('expanded');
            }
            
            // Resize charts
            Object.values(charts).forEach(chart => {
                if (chart && typeof chart.resize === 'function') {
                    chart.resize();
                }
            });
        }

        // Toggle sidebar for mobile
        function toggleSidebar() {
            const sidebar = $('#sidebar');
            sidebar.toggleClass('show');
        }

        // Setup event listeners
        function setupEventListeners() {
            // Navigation
            $('.nav-link').on('click', function(e) {
                e.preventDefault();
                const tab = $(this).data('tab');
                switchTab(tab);
                
                // Close mobile sidebar
                if (window.innerWidth <= 768) {
                    $('#sidebar').removeClass('show');
                }
            });

            // Close sidebar when clicking outside on mobile
            $(document).on('click', function(e) {
                if (window.innerWidth <= 768) {
                    const sidebar = $('#sidebar');
                    const toggle = $('.mobile-menu-toggle');
                    
                    if (!sidebar.is(e.target) && sidebar.has(e.target).length === 0 && 
                        !toggle.is(e.target) && toggle.has(e.target).length === 0) {
                        sidebar.removeClass('show');
                    }
                }
            });
        }

        // Switch tabs
        function switchTab(tabName) {
            $('.nav-link').removeClass('active');
            $(`.nav-link[data-tab="${tabName}"]`).addClass('active');
            
            $('.tab-content').removeClass('active');
            $(`#${tabName}`).addClass('active');
        }

        // Load all data from Firebase
        function loadAllData() {
            showLoading(true);
            
            const promises = [
                fetchData('logs'),
                fetchData('tshark'),
                fetchData('data_intercepts')
            ];
            
            Promise.all(promises).then(() => {
                updateDashboard();
                showLoading(false);
            }).catch(error => {
                console.error('Error loading data:', error);
                showLoading(false);
                updateApiStatus('offline');
            });
        }

        // Fetch data from Firebase
        function fetchData(endpoint) {
            return $.ajax({
                url: FIREBASE_URLS[endpoint],
                method: 'GET',
                dataType: 'json'
            }).done(function(data) {
                if (endpoint === 'logs') logsData = data || {};
                else if (endpoint === 'tshark') tsharkData = data || {};
                else if (endpoint === 'data_intercepts') interceptData = data || {};
                
                updateApiStatus('online', endpoint);
            }).fail(function() {
                updateApiStatus('offline', endpoint);
            });
        }

        // Update API status indicators
        function updateApiStatus(status, endpoint = 'all') {
            const statusClass = status === 'online' ? 'status-online' : 'status-offline';
            
            if (endpoint === 'all' || endpoint === 'logs') {
                $('#logsStatus').removeClass('status-online status-offline').addClass(statusClass);
                $('#logsApiStatus').text(status === 'online' ? 'Connected' : 'Disconnected');
            }
            if (endpoint === 'all' || endpoint === 'tshark') {
                $('#tsharkStatus').removeClass('status-online status-offline').addClass(statusClass);
                $('#tsharkApiStatus').text(status === 'online' ? 'Connected' : 'Disconnected');
            }
            if (endpoint === 'all' || endpoint === 'data_intercepts') {
                $('#interceptStatus').removeClass('status-online status-offline').addClass(statusClass);
                $('#interceptApiStatus').text(status === 'online' ? 'Connected' : 'Disconnected');
            }
        }

        // Show/hide loading indicator
        function showLoading(show) {
            if (show) {
                $('#loadingIndicator').show();
                $('#fetchStatus').text('Updating...');
            } else {
                $('#loadingIndicator').hide();
                $('#fetchStatus').text('Live');
            }
        }

        // Update dashboard with new data
        function updateDashboard() {
            updateStatCards();
            updateRecentActivity();
            updateNetworkLogs();
            updateInterceptWeb();
            updateInterceptLogs();
            updateCharts();
        }

        // Update stat cards
        function updateStatCards() {
            const logsCount = Object.keys(logsData).filter(key => 
                logsData[key].status === 'success').length;
            const interceptCount = Object.keys(interceptData).filter(key => 
                interceptData[key].status === 'success').length;
            const tsharkCount = Object.keys(tsharkData).filter(key => 
                tsharkData[key].status === 'success').length;
            
            $('#totalLogs').text(logsCount);
            $('#totalIntercepts').text(interceptCount);
            $('#totalTshark').text(tsharkCount);
            $('#activeConnections').text(Math.floor(Math.random() * 50) + 10);
        }

        // Update recent activity table
        function updateRecentActivity() {
            const tbody = $('#recentActivityTable');
            tbody.empty();
            
            const allData = [];
            
            // Combine all data sources
            Object.entries(interceptData).forEach(([key, item]) => {
                if (item.status === 'success') {
                    allData.push({
                        timestamp: item.timestamp,
                        type: 'Data Intercept',
                        target: item.target,
                        status: item.status,
                        details: item.data_interception || 'N/A'
                    });
                }
            });
            
            // Sort by timestamp (newest first)
            allData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            // Show only recent 10 items
            allData.slice(0, 10).forEach(item => {
                tbody.append(`
                    <tr>
                        <td>${formatTimestamp(item.timestamp)}</td>
                        <td><span class="badge bg-primary">${item.type}</span></td>
                        <td>${item.target}</td>
                        <td><span class="badge bg-success">${item.status}</span></td>
                        <td>${truncateText(item.details, 50)}</td>
                    </tr>
                `);
            });
            
            if (allData.length === 0) {
                tbody.append('<tr><td colspan="5" class="text-center text-muted">No recent activity</td></tr>');
            }
        }

        // Update network logs table
        function updateNetworkLogs() {
            const tbody = $('#networkLogsTable');
            tbody.empty();
            
            Object.entries(logsData).forEach(([key, item]) => {
                if (item.status === 'success') {
                    tbody.append(`
                        <tr>
                            <td>${formatTimestamp(item.timestamp)}</td>
                            <td>${item.source || 'N/A'}</td>
                            <td>${item.destination || 'N/A'}</td>
                            <td><span class="badge bg-info">${item.protocol || 'Unknown'}</span></td>
                            <td><span class="badge bg-success">${item.status}</span></td>
                            <td>
                                <button class="action-btn btn-hide" onclick="hideItem('logs', '${key}')">
                                    <i class="fas fa-eye-slash"></i>
                                </button>
                                <button class="action-btn btn-delete" onclick="deleteItem('logs', '${key}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                }
            });
            
            if (tbody.children().length === 0) {
                tbody.append('<tr><td colspan="6" class="text-center text-muted">No network logs available</td></tr>');
            }
        }

        // Update intercept web data
        function updateInterceptWeb() {
            const container = $('#interceptWebContainer');
            container.empty();
            
            Object.entries(interceptData).forEach(([key, item]) => {
                if (item.status === 'success') {
                    const card = $(`
                        <div class="dashboard-card mb-3">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h6 class="text-primary">${item.data_interception || 'Data Intercept'}</h6>
                                    <small class="text-muted">${formatTimestamp(item.timestamp)}</small>
                                </div>
                                <div>
                                    <button class="action-btn btn-hide" onclick="hideItem('data_intercepts', '${key}')">
                                        <i class="fas fa-eye-slash"></i>
                                    </button>
                                    <button class="action-btn btn-delete" onclick="deleteItem('data_intercepts', '${key}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Target:</strong> ${item.target}</p>
                                    <p><strong>Port:</strong> ${item.port}</p>
                                    <p><strong>Type:</strong> ${item.type}</p>
                                    <p><strong>Connection:</strong> ${item.Connection || 'N/A'}</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Status:</strong> <span class="badge bg-success">${item.status}</span></p>
                                </div>
                            </div>
                            
                            ${item.headers ? `
                                <div class="mt-3">
                                    <h6>Headers:</h6>
                                    <div class="collapsible-content" id="headers-${key}">
                                        ${formatHeaders(item.headers)}
                                    </div>
                                    <button class="expand-btn" onclick="toggleCollapse('headers-${key}')">
                                        <i class="fas fa-chevron-down"></i> Show More
                                    </button>
                                </div>
                            ` : ''}
                            
                            ${item.body ? `
                                <div class="mt-3">
                                    <h6>Body:</h6>
                                    <div class="collapsible-content" id="body-${key}">
                                        <pre class="text-muted">${item.body}</pre>
                                    </div>
                                    <button class="expand-btn" onclick="toggleCollapse('body-${key}')">
                                        <i class="fas fa-chevron-down"></i> Show More
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    `);
                    
                    container.append(card);
                }
            });
            
            if (container.children().length === 0) {
                container.html('<div class="text-center text-muted">No intercept data available</div>');
            }
        }

        // Update intercept logs table
        function updateInterceptLogs() {
            const tbody = $('#interceptLogsTable');
            tbody.empty();
            
            Object.entries(interceptData).forEach(([key, item]) => {
                if (item.status === 'success') {
                    tbody.append(`
                        <tr>
                            <td>${formatTimestamp(item.timestamp)}</td>
                            <td><span class="badge bg-warning">${item.type || 'Unknown'}</span></td>
                            <td>${item.target}</td>
                            <td>${item.port}</td>
                            <td><span class="badge bg-success">${item.status}</span></td>
                            <td>
                                <button class="action-btn btn-hide" onclick="hideItem('data_intercepts', '${key}')">
                                    <i class="fas fa-eye-slash"></i>
                                </button>
                                <button class="action-btn btn-delete" onclick="deleteItem('data_intercepts', '${key}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                }
            });
            
            if (tbody.children().length === 0) {
                tbody.append('<tr><td colspan="6" class="text-center text-muted">No intercept logs available</td></tr>');
            }
        }

        // Initialize charts
        function initializeCharts() {
            // Traffic Analysis Chart
            const trafficCtx = document.getElementById('trafficChart').getContext('2d');
            charts.traffic = new Chart(trafficCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Traffic Volume',
                        data: [],
                        borderColor: '#ff6a00',
                        backgroundColor: 'rgba(255, 106, 0, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#ffffff' }
                        }
                    },
                    scales: {
                        x: { ticks: { color: '#9aa0a6' } },
                        y: { ticks: { color: '#9aa0a6' } }
                    }
                }
            });

            // Protocol Distribution Chart
            const protocolCtx = document.getElementById('protocolChart').getContext('2d');
            charts.protocol = new Chart(protocolCtx, {
                type: 'doughnut',
                data: {
                    labels: ['HTTP', 'HTTPS', 'TCP', 'UDP', 'Other'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#ff6a00',
                            '#e05500',
                            '#ff8533',
                            '#ffaa66',
                            '#9aa0a6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#ffffff' }
                        }
                    }
                }
            });
        }

        // Update charts with new data
        function updateCharts() {
            // Update traffic chart with sample data
            const now = new Date();
            const labels = [];
            const data = [];
            
            for (let i = 6; i >= 0; i--) {
                const time = new Date(now.getTime() - i * 60000);
                labels.push(time.toLocaleTimeString());
                data.push(Math.floor(Math.random() * 100) + 20);
            }
            
            charts.traffic.data.labels = labels;
            charts.traffic.data.datasets[0].data = data;
            charts.traffic.update();
            
            // Update protocol chart
            const protocolCounts = [
                Math.floor(Math.random() * 50) + 10,
                Math.floor(Math.random() * 40) + 15,
                Math.floor(Math.random() * 30) + 5,
                Math.floor(Math.random() * 20) + 3,
                Math.floor(Math.random() * 10) + 1
            ];
            
            charts.protocol.data.datasets[0].data = protocolCounts;
            charts.protocol.update();
        }

        // Utility functions
        function formatTimestamp(timestamp) {
            return new Date(timestamp).toLocaleString();
        }

        function truncateText(text, maxLength) {
            if (!text) return 'N/A';
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }

        function formatHeaders(headers) {
            if (!headers) return 'No headers';
            
            let html = '<div class="row">';
            Object.entries(headers).forEach(([key, value]) => {
                html += `
                    <div class="col-md-6 mb-2">
                        <strong>${key}:</strong><br>
                        <span class="text-muted">${truncateText(value, 100)}</span>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function toggleCollapse(elementId) {
            const element = $(`#${elementId}`);
            const button = element.next('.expand-btn');
            
            element.toggleClass('expanded');
            
            if (element.hasClass('expanded')) {
                button.html('<i class="fas fa-chevron-up"></i> Show Less');
            } else {
                button.html('<i class="fas fa-chevron-down"></i> Show More');
            }
        }

        // CRUD operations
        function hideItem(collection, key) {
            if (confirm('Are you sure you want to hide this item?')) {
                const url = `https://techwiz-7f7ab-default-rtdb.firebaseio.com/${collection}/${key}/status.json`;
                
                $.ajax({
                    url: url,
                    method: 'PUT',
                    data: JSON.stringify('hide'),
                    contentType: 'application/json'
                }).done(function() {
                    loadAllData();
                }).fail(function() {
                    alert('Failed to hide item');
                });
            }
        }

        function deleteItem(collection, key) {
            if (confirm('Are you sure you want to delete this item? This action cannot be undone.')) {
                const url = `https://techwiz-7f7ab-default-rtdb.firebaseio.com/${collection}/${key}.json`;
                
                $.ajax({
                    url: url,
                    method: 'DELETE'
                }).done(function() {
                    loadAllData();
                }).fail(function() {
                    alert('Failed to delete item');
                });
            }
        }
    </script>
</body>
</html>
